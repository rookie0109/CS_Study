## 详细流程
笛卡尔坐标系下
1.根据routing模块的图确定相应道路
2.首先根据自车位置确定在对应的道路中心线位置，向前150m,向后30m确定参考线的初值，之后对于初值添加与x轴的夹角和曲率(前向差分，后向差分取中值 k = sin(diff_heading) / ds),参考线上的点(应该有索引，曲率，方向角等等)
3.得到参考线之后，找相应的匹配点和投影点，根据匹配点向前向后截相应的点
4.平滑参考线(还可以拼接，每次只更新新增的点)
平滑需要考虑1）平滑代价(三点，两个向量的和的大小)2）路径长度尽可能均匀(散点距离的和)，3)参考线偏离的代价函数。其中平滑还能考虑两个向量之间的夹角(不是二次项了)，相应约束是不能离参考线太远，还有相应的曲率约束(非线性约束||2p_i - p_i+1 - p_i-1|| - slack <= d * d / r_min> ),d是离散点之间的长度，线性化是在参考点之间泰勒展开
4.计算规划起点
如果是第一次就一车辆自身作为起点，如果不为空，找到上一时刻轨迹对应当前时间，确定该点与自车本身的位置之间的偏差，大于一定程度(2.5, 0.5)则表示控制存在差错，直接将当前章台向前递推一定的位置作为规划起点。或者找到相应的点作为规划起点，并在该点上向前找20个点，与本次结果一起发给控制。
frenet坐标系下
将上述参考线从笛卡尔坐标系转换到frenet坐标系下，以自车头顶点为s原点
5.sl 规划
设置规划起点，找到匹配点和投影点
在前方一定距离撒点1m为间隔，均匀撒点，使用五次多项式作为节点之间连接的路径，平滑代价(dl / ds, dl / ds/ ds, dl / ds / ds/ ds的平方相加)，参考线代价和碰撞代价，确定通过循序之后，再次使用五次多项式进行插值，间隔1m
之后根据障碍物与道路边界每一格s上对应l的约束。
之后求解QP问题，参考线代价，光滑性代价，凸空间中央代价终端代价，其次约束:凸空间约束，加速度变化约束，加速度约束，得到优化后的点，再次增密，得到路径后转换到笛卡尔坐标系下
优化的是什么变量？？

速度规划与路径规划类似，终点在于st图的生成，不用考虑太远的障碍物
采样的时候可以不均匀，越远的越稀疏
生成凸空间的时候，根据曲率确定最大加速度限制，根据障碍物的位置和速度确定速度限制
代价：加速度代价，推荐速度代价，加加速度的代价
优化的是什么变量？？
增密的原因是：如果优化的点太多QP计算较慢，但控制的频率较高，需要非常密集的点


两者迭代优化：速度规划使用上一帧st规划处理on coming 或者低速的物体

osqp_eigen使用：先建立一个solver,其次设置求解器setting()，是否warm_start,最大迭代次数等等
data()，设置变量个数，约束个数，上下边界约束矩阵，H与f,最后求解，直接getsolution

场景确认方法：
查看参考线与路口，交通灯，自车状态等重叠情况
